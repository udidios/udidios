Vue.createApp({data:()=>({section:1,query:"",isFetching:!1,searchResults:[],currentPopular:"films",popularData:null,popular:null}),created(){document.referrer.includes("rkn.gov.ru")&&(location.href="404"),console.info("App created.")},methods:{setTitle(t){document.title=t},toHome(){let t=new URL(window.location.href.split("?")[0]);t.hash="",window.history.pushState(null,"",t),window.dispatchEvent(new Event("popstate")),this.section=1},toPlayer(t){let e=new URL(window.location.href.split("?")[0]);e.hash=t,window.history.pushState(null,"",e),window.dispatchEvent(new Event("popstate")),this.section=3},isPopular(t){return this.currentPopular===t},setPopular(t){this.currentPopular=t,this.popular=null,this.popular=this.popularData[t]},posterUrl:t=>`https://st.kp.yandex.net/images/film_iphone/iphone360_${t}.jpg`,filmTitle:t=>t||"–",filmYear:t=>t||"–",filmRating:t=>t?t.toFixed(1):"–",filmRatingBase:t=>t?Math.trunc(t):"0",coverUrl:t=>t?t.replace(/360$/,"300x450"):"https://st.kp.yandex.net/images/no-poster.gif",hasQuery:()=>new URL(window.location).searchParams.has("q"),getQuery:()=>new URL(window.location).searchParams.get("q")||"",setQuery(t){let e=new URL(window.location);e.searchParams.set("q",t),window.history.pushState(null,t,e),window.dispatchEvent(new Event("popstate"))},hasHash:()=>window.location.hash.length>1,getHash:()=>window.location.hash.substring(1),isId:t=>!!(t.match(/^(\d{3,9})$/)||t.match(/^(tt\d{4,9})$/)),submitSearch(){0!==this.query.length&&(this.isId(this.query)?this.toPlayer(this.query):this.setQuery(this.query))},getSection(){return this.hasQuery()?2:this.hasHash()?3:1},async handleUrl(){this.section=this.getSection(),this.query=this.getQuery()||this.getHash()||"",await this.fetchSectionContent()},async fetchSectionContent(){var t,e;if(1===this.section&&(this.setTitle("Фильмы и сериалы онлайн - Kinobox.in"),!this.popularData))try{this.isFetching=!0;let s=await fetch("https://kinobox.tv/api/films/popular/"),i=await s.json();this.popularData={films:i.filter(t=>"Film"===t.type),series:i.filter(t=>"Series"===t.type)},this.popular=this.popularData.films,this.isFetching=!1}catch(a){console.error(a),this.popularData={films:[],series:[]},this.isFetching=!1,this.popular=[]}if(2===this.section){this.setTitle(`${this.getQuery()} - результаты поиска`),this.searchResults=[],this.isFetching=!0;let h=await fetch(`https://kinobox.tv/api/films/search/?title=${this.getQuery()}`);this.searchResults=await h.json(),this.isFetching=!1}3===this.section&&(this.setTitle(`#${this.getHash()} - смотреть онлайн`),setTimeout(()=>{new Kinobox(".kinobox_player",{search:{query:this.getHash()}}).init()},1)),t=document,e=screen,new Image().src="https://counter.yadro.ru/hit;kinoboxtv?t38.6;r"+escape(t.referrer)+(void 0===e?"":";s"+e.width+"*"+e.height+"*"+(e.colorDepth?e.colorDepth:e.pixelDepth))+";u"+escape(t.URL)+";h"+escape(t.title.substring(0,150))+";"+Math.random()}},async mounted(){this.query=decodeURI(this.getQuery()),await this.handleUrl(),window.addEventListener("popstate",async()=>{await this.handleUrl()})}}).mount("#app"),(()=>{let t=document.querySelector(".button-top");t&&(t.addEventListener("click",t=>{t.preventDefault(),window.scrollTo(0,0)}),setTimeout(()=>{0!==window.scrollY&&(t.style.visibility="visible")}),window.addEventListener("scroll",()=>{let e=0===window.scrollY;t.style.visibility=e?"hidden":"visible"}))})();
